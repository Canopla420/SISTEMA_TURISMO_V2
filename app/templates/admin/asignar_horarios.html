{% extends "base.html" %}

{% block title %}Asignar Horarios - Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>‚è∞ Asignar Horarios</h1>
    <a href="/admin/solicitudes" class="btn btn-secondary">‚Üê Volver a Solicitudes</a>
</div>

<!-- Informaci√≥n de la Solicitud -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">üìã Solicitud #{{ solicitud.id }} - {{ solicitud.nombre_institucion }}</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Fecha solicitada:</strong> {{ fecha_visita }}</p>
                <p><strong>Cantidad de alumnos:</strong> {{ solicitud.cantidad_alumnos }}</p>
                <p><strong>Localidad:</strong> {{ solicitud.localidad }}</p>
                <p><strong>Nivel:</strong> {{ solicitud.tipo_institucion }}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Contacto:</strong> {{ solicitud.contacto }}</p>
                <p><strong>Tel√©fono:</strong> {{ solicitud.telefono }}</p>
                <p><strong>Horario preferido:</strong> {{ solicitud.horario_preferido }}</p>
                <p><strong>Observaciones:</strong> {{ solicitud.observaciones }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Formulario de Asignaci√≥n de Horarios -->
<form id="asignar-horarios-form" method="POST" action="{{ url_for('admin.guardar_horarios', id=solicitud.id) }}">
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">Prestadores Solicitados - Coordinar Horarios</h5>
        </div>
        <div class="card-body">
            {% for prestador in solicitud.get_prestadores_seleccionados() %}
            <div class="row mb-4 p-3 border rounded bg-light">
                <div class="col-md-4">
                    <h6 class="text-primary">{{ prestador }}</h6>
                </div>
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Hora inicio:</label>
                            <input type="time" class="form-control" name="{{ prestador }}_inicio">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Hora fin:</label>
                            <input type="time" class="form-control" name="{{ prestador }}_fin">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Grupo:</label>
                            <select class="form-select" name="{{ prestador }}_grupo">
                                <option value="1">Grupo 1</option>
                                <option value="2">Grupo 2</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Observaciones:</label>
                            <input type="text" class="form-control" name="{{ prestador }}_obs" placeholder="Observaciones">
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Resumen y Acciones -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">Resumen del Itinerario</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h6>Itinerario coordinado para {{ solicitud.fecha }}:</h6>
                    <ul class="list-group list-group-flush">
                        <!-- Pod√©s mostrar el itinerario din√°micamente si ten√©s los horarios asignados -->
                    </ul>
                </div>
                <div class="col-md-4">
                    <h6>Informaci√≥n del grupo:</h6>
                    <p><strong>Total:</strong> {{ solicitud.cantidad_alumnos }} alumnos + {{ solicitud.cantidad_docentes|default(0) }} docentes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Botones de Acci√≥n -->
    <div class="d-flex gap-3 justify-content-end">
        <a href="/admin/solicitudes" class="btn btn-secondary">‚ùå Cancelar</a>
        <button type="button" class="btn btn-warning" onclick="guardarBorrador()">üíæ Guardar Borrador</button>
        <button type="submit" class="btn btn-success btn-lg">‚úÖ Confirmar y Crear Visitas</button>
    </div>
</form>

<script>
function guardarBorrador() {
    alert('Borrador guardado. Puede continuar coordinando m√°s tarde.');
}
</script>
{% endblock %}